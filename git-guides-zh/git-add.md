# Git Add

`git add` 命令将工作目录中的新文件或更改的文件添加到 Git 暂存区。

`git add` 是一个重要的命令 - 没有它，任何 `git commit` 都不会做任何事情。有时候，`git add` 可能会被认为是不必要的开发步骤。但实际上，`git add` 是一个重要且强大的工具。`git add` 允许你在不改变工作方式的情况下塑造历史。

## 什么时候使用 `git add`？

```sh
git add README.md
```

当你工作时，你会更改并保存一个或多个文件。然后，在提交之前，你必须使用 `git add`。这一步允许你选择要提交的内容。提交应该是逻辑的、原子的更改单元 - 但并不是每个人都这样工作。也许你正在对文件进行更改，这些更改不是逻辑或原子的更改单元。`git add` 允许你系统地塑造你的提交和历史。

### Git Add 的作用是什么？

`git add [文件名]` 选择该文件，并将其移动到暂存区，标记为包含在下一次提交中。你可以选择所有文件、一个目录、特定文件，甚至是文件的特定部分进行暂存和提交。

这意味着如果你 `git add` 一个已删除的文件，删除操作将被暂存以进行提交。当你实际上是在"删除"时使用"添加"的语言可能会让人困惑。如果你用 `git stage` 代替 `git add` 来思考或使用，发生的事情可能会更清晰。

`git add` 和 `git commit` 是密不可分的。它们在不一起使用时不起作用。而且，当考虑到它们的联合功能时，它们的效果最好。

## 如何使用 `git add`

### `git add` 的常见用法和选项

* `git add <路径>`：暂存特定目录或文件
* `git add -A`：暂存整个仓库中的所有文件（不包括 `.gitignore` 中列出的文件）
* `git add -p`：交互式暂存更改块

你可以在 [git-scm 的文档](https://git-scm.com/docs/git-add) 中查看 `git add` 的所有选项。

## `git add` 的示例

`git add` 通常按以下步骤融入工作流程：

1. 创建分支：`git branch update-readme`
2. 检出到该分支：`git checkout update-readme`
3. 更改一个或多个文件
4. 保存文件
5. 添加应包含在下一次提交中的文件或代码段：`git add README.md`
6. 提交更改：`git commit -m "更新 README 以包含贡献指南的链接"`
7. 将更改推送到远程分支：`git push -u origin update-readme`

但是，`git add` 也可以这样使用：

1. 创建分支：`git branch update-readme`
2. 检出到该分支：`git checkout update-readme`
3. 更改一个或多个文件
4. 保存文件
5. 只添加一个文件，或更改文件的一部分：`git add README.md`
6. 提交第一组更改：`git commit -m "更新 README 以包含贡献指南的链接"`
7. 添加另一个文件，或更改文件的另一部分：`git add CONTRIBUTING.md`
8. 提交第二组更改：`git commit -m "创建贡献指南"`
9. （根据需要重复）
10. 将更改推送到远程分支：`git push -u origin update-readme`

### `git add` 所有文件

暂存所有可用文件是一个流行但有风险的操作。这可以节省时间，但风险有两个方面：

#### 历史记录考虑不周

通过暂存所有可用更改，你的历史记录的清晰度可能会受到影响。能够塑造你的历史是使用 Git 的最大优势之一。如果你的提交太大，包含不相关的更改，或者在提交消息中描述不清楚，你将失去查看和更改历史的好处。

#### 意外暂存和提交文件

通过使用一次性添加所有文件的选项，你可能会意外暂存和提交文件。大多数常用标志不会添加 `.gitignore` 文件中跟踪的文件。但是，任何未列在 `.gitignore` 文件中的文件都将被暂存和提交。这适用于大型二进制文件，以及包含密码或认证令牌等敏感信息的文件。

#### 决定暂存所有文件

如果现在是暂存所有文件的合适时机，你可以从几个命令中选择。一如既往，了解你正在暂存和提交的内容非常重要。

* `git add -A`：暂存所有文件，包括新文件、修改的文件和删除的文件，包括当前目录和仍然属于同一 git 仓库的更高目录中的文件
* `git add .`：递归添加整个目录，包括名称以点开头的文件
* `git add -u`：仅暂存修改和删除的文件，不包括新文件

| 命令 | 新文件 | 修改的文件 | 删除的文件 | 名称以点开头的文件 | 当前目录 | 更高目录 |
| ------------- | ------------- | ---- | ---- | ------ | ----- | ----- |
| `git add -A` | 是 | 是 | 是 | 是 | 是 | 是 |
| `git add .` | 是 | 是 | 是 | 是 | 是 | 否 |
| `git add -u` | 否 | 是 | 是 | 是 | 是 | 是 |

### `git add` 文件夹或特定文件

使用 `git add` 最安全和最清晰的方式是指定要暂存的特定文件或目录。语法可能如下：

`git add directory/`：暂存名为 `directory` 的目录中所有文件的所有更改
`git add README.md`：暂存 `README.md` 文件中的所有更改

### 撤销已添加的文件

在撤销 `git add` 之前，你应该首先确保不会丢失任何工作。没有办法像撤销提交那样"撤销"添加，但你可以将文件移出暂存区。

例如，如果你有一个暂存的文件，然后你在工作目录中对该文件进行了更多更改。现在，工作目录和暂存区中的版本不同。如果你采取行动从暂存区中删除更改后的文件版本，工作目录中但未暂存的更改将被覆盖。

为了避免这种情况，首先暂存所有更改，然后一起取消暂存，或者提交更改并在提交发生前重置。

#### 使用 `git reset` 撤销 `git add`

`git reset` 是一个灵活而强大的命令。它的许多用例之一是将更改移出暂存区。为此，使用"混合"级别的重置，这是默认设置。

要将暂存的更改从暂存区移动到工作目录而不影响已提交的历史记录，首先确保你没有对相关文件进行任何额外的更改，如上所述。然后，输入 `git reset HEAD`（即 `git reset --mixed HEAD`）。

## 相关术语

* `git status`：总是个好主意，这个命令显示你在哪个分支上，工作区或暂存区中有哪些文件，以及其他重要信息。
* `git checkout [分支名称]`：切换到指定分支并更新工作目录。
* `git commit -m "描述性消息"`：在版本历史中永久记录文件快照。
* `git push`：将所有本地分支提交上传到远程。 