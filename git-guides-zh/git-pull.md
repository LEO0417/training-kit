# Git Pull

`git pull` 更新你当前的本地工作分支和所有远程跟踪分支。定期在你本地工作的分支上运行 `git pull` 是个好主意。

没有 `git pull`（或其效果），你的本地分支将不会有远程上存在的任何更新。

## `git pull` 的作用是什么？

```sh
git pull
```

`git pull` 是 Git 中 4 个远程操作之一。如果不运行 `git pull`，你的本地仓库将永远不会更新远程的更改。`git pull` 应该在你与有远程的仓库交互的每一天至少使用一次。这就是为什么 `git pull` 是最常用的 Git 命令之一。

### `git pull` 和 `git fetch`

`git pull` 是 `git fetch` + `git merge` 的组合，使用远程仓库的更改更新本地仓库的某些部分。要理解 `git pull` 影响和不影响的内容，你需要首先理解远程跟踪分支的概念。当你克隆一个仓库时，你克隆一个工作分支 `main` 和所有远程跟踪分支。`git fetch` 更新远程跟踪分支。`git merge` 将使用远程跟踪分支上的任何新提交更新你的当前分支。

`git pull` 是更新仓库的最常见方式。

然而，你可能想使用 `git fetch` 代替。这样做的一个原因可能是你预期会有冲突。如果你有新的本地提交和远程上的新提交，可能会以这种方式发生冲突。就像两个不同分支之间可能发生的合并冲突一样，这两条不同的历史线可能包含对同一文件的相同部分的更改。如果你首先操作 `git fetch`，合并将不会被启动，你也不会被提示解决冲突。这让你可以灵活地在不需要网络连接的情况下稍后解决冲突。

你可能想运行 `git fetch` 的另一个原因是在失去网络连接之前更新所有远程跟踪分支。如果你运行 `git fetch`，然后稍后尝试在没有网络连接的情况下运行 `git pull`，`git pull` 操作的 `git fetch` 部分将失败。

如果你确实使用 `git fetch` 而不是 `git pull`，请确保记住 `git merge`。将远程跟踪分支合并到你自己的分支确保你将使用任何更新或更改。

## 如何使用 `git pull`

### `git pull` 的常见用法和选项

* `git pull`：使用远程的提交更新你的本地工作分支，并更新所有远程跟踪分支。
* `git pull --rebase`：使用远程的提交更新你的本地工作分支，但重写历史，使任何本地提交发生在来自远程的所有新提交之后，避免合并提交。
* `git pull --force`：此选项允许你在使用 `<refspec>` 选项时强制获取特定的远程跟踪分支，否则由于冲突而不会被获取。要强制 Git 覆盖你的当前分支以匹配远程跟踪分支，请阅读下面关于使用 `git reset` 的内容。
* `git pull --all`：获取所有远程 - 如果你正在处理一个 fork 或在另一个有多个远程的用例中，这很方便。

你可以在 [git-scm 的文档](https://git-scm.com/docs/git-pull) 中查看 `git pull` 的所有选项。

## `git pull` 的示例

### 在分支上工作

如果你已经在分支上工作，在开始工作并引入新提交之前运行 `git pull` 是个好主意。即使你从开发中休息一小会儿，你的协作者也有可能对你的分支进行了更改。这个更改甚至可能来自使用 `main` 的新更改更新你的分支。

运行 `git status` 总是一个好主意 - 特别是在 `git pull` 之前。未提交的更改可能在 `git pull` 期间被覆盖。或者，它们可以阻止 `git pull` 的 `git merge` 部分执行。如果你有已更改但未提交的文件，并且远程上的更改也更改了同一文件的相同部分，Git 必须做出选择。由于它们不是已提交的更改，不可能有合并冲突。Git 将覆盖工作区或暂存区中的更改，或者 `merge` 将不会完成，你将无法包含来自远程的任何更新。

如果发生这种情况，使用 `git status` 识别导致问题的更改。删除或提交这些更改，然后再次 `git pull` 或 `git merge`。

### 保持 `main` 最新

保持 `main` 分支最新通常是个好主意。

例如，假设你克隆了一个仓库。在你克隆后，有人将分支合并到 main。然后，你想创建一个新分支来做一些工作。如果你在操作 `git pull` 之前从 `main` 创建你的分支，你的分支将不会有最近的更改。你可能会意外引入冲突或重复更改。通过在创建分支之前运行 `git pull`，你可以确保你将使用最新的信息。

### 撤销 `git pull`

要有效地"撤销" `git pull`，你不能撤销 `git fetch` - 但你可以撤销更改本地工作分支的 `git merge`。

要做到这一点，你需要 `git reset` 到你合并之前所做的提交。你可以通过搜索 `git reflog` 找到这个提交。reflog 是 HEAD 指向的每个地方的日志 - 你曾经检出到的每个地方。这个 reflog 只保留 30 到 90 天，取决于提交，并且只存储在本地。*（reflog 是一个很好的理由，如果你认为你犯了错误，不要删除仓库！）*

运行 `git reflog` 并搜索你想要返回的提交。然后，运行 `git reset --hard <SHA>` 将 HEAD 和当前分支重置到合并之前的提交的 SHA。

### 强制 `git pull` 覆盖本地文件

如果你在本地进行了你后悔的提交，你可能希望你的本地分支匹配远程分支而不保存任何你的工作。这可以使用 `git reset` 完成。首先，确保你有该远程跟踪分支的最新副本。

`git fetch <remote> <branch>`
例如：`git fetch origin main`

然后，使用 `git reset --hard` 将 HEAD 指针和当前分支指针移动到该远程跟踪分支上存在的最新提交。

`git reset --hard <remote>/<branch>`
例如：`git reset --hard origin/main`

> _注意：你可以使用 `git remote -v` 找到远程，并使用 `git branch --all` 查看所有可用的远程跟踪分支。_

### 使用 Rebase 的 `git pull`

如果本地分支和远程分支上都有新提交，当你 `git pull` 时将创建一个合并提交。当历史中有两个分裂被合并在一起时，这种递归合并是默认的合并风格。但是，你可能希望分支上的历史只有一条线。

你可以使用远程的提交更新本地工作分支，但重写历史，使任何本地提交发生在来自远程的所有新提交之后，避免合并提交。
这是通过 `git pull --rebase` 完成的。

使用 `git pull --rebase` 不会影响更改或提交的完整性，但会影响历史在提交父子关系中的外观。

## 相关术语

- `git clone [url]`：克隆（下载）GitHub 上已存在的仓库，包括所有文件、分支和提交。
- `git status`：总是一个好主意，这个命令显示你在哪个分支上，工作区或暂存区中有哪些文件，以及其他重要信息。
- `git branch`：这显示本地仓库中现有的分支。你也可以使用 `git branch [分支名]` 从当前位置创建分支，或 `git branch --all` 查看所有分支，包括本地机器上的分支和从上次 `git pull` 或 `git fetch` 远程存储的远程跟踪分支。
- `git push`：将所有本地分支提交上传到远程。
- `git log`：浏览和检查项目文件的演变。
- `git remote -v`：显示关联的远程仓库及其存储的名称，如 `origin`。 