# Git Commit

`git commit` 创建一个提交，这就像是你的仓库的快照。这些提交是在特定时间点对整个仓库的快照。你应该经常基于逻辑更改单元创建新的提交。随着时间的推移，提交应该讲述你的仓库的历史故事，以及它是如何变成现在这样的。除了内容和消息外，提交还包含大量元数据，如作者、时间戳等。

## Git Commit 的工作原理

提交是 Git 版本控制中"保存点"的构建块。

```sh
git commit -m "更新 README.md，添加贡献指南链接"
```

### 提交塑造历史

通过使用提交，你能够有意且安全地塑造历史。你可以向不同的分支提交，并确切指定你想要包含的更改。提交是在你当前检出的分支上创建的（无论 HEAD 指向哪里），所以在提交之前运行 `git status` 总是一个好主意，以检查你是否检出了你打算使用的分支。在提交之前，你需要使用 `git add [文件]` 暂存你想要包含在提交中的任何新更改。

提交是 Git 中的轻量级 SHA 哈希对象。只要你处理的是文本文件，你就不需要担心你有多少文件，它们有多大，或者你做了多少次提交。Git 可以处理它！

### 两阶段提交

提交有两个阶段来帮助你正确塑造提交。提交应该是代表特定想法的逻辑、原子的更改单元。但是，并不是所有人都这样工作。你可能会忘记，在记住提交之前解决了两个或三个问题！没关系 - Git 可以处理这种情况。一旦你准备好塑造你的提交，你将使用 `git add <文件名>` 来指定你想要"暂存"以进行提交的文件。如果不添加任何文件，命令 `git commit` 将不起作用。Git 只查看暂存区来找出要提交的内容。暂存或添加文件可以通过命令行完成，也可以通过大多数 Git 界面（如 GitHub Desktop）通过选择你想要暂存的行或文件来完成。

你还可以使用一个方便的命令 `git add -p` 来遍历更改并将它们分开，即使它们在同一文件中。

## 如何使用 Git Commit

### Git Commit 的常见用法和选项

- `git commit`：这开始提交过程，但由于它不包含消息的 `-m` 标志，你的默认文本编辑器将被打开以创建提交消息。如果你没有配置任何内容，这很可能是 VI 或 Vim。（要退出，按 Esc，然后 `:wq`，然后按 Enter。😉）
- `git commit -m "描述性提交消息"`：这开始提交过程，并允许你同时包含提交消息。
- `git commit -am "描述性提交消息"`：除了包含提交消息外，此选项允许你跳过暂存阶段。添加 `-a` 将自动暂存 Git 已经在跟踪的任何文件（你之前提交过的文件的更改）。
- `git commit --amend`：用新的提交替换最近的提交。（稍后会详细介绍！）

要查看 `git commit` 的所有可能选项，请查看 [Git 的文档](https://git-scm.com/docs/git-commit)。

### 如何在 Git 中撤销提交

有时，你可能需要更改历史。你可能需要撤销提交。如果你发现自己处于这种情况，有几件非常重要的事情要记住：

- 如果你正在"撤销"存在于远程的提交，你可能会为你的协作者创建大问题
- 撤销仅在你本地的工作上的提交要安全得多

### 更改历史时可能出现什么问题？

为协作者更改历史可能会在几个方面造成问题。想象一下 - 你和另一个协作者有相同的仓库，有相同的历史。但是，他们做了一个更改，删除了最近的提交。他们从该提交之前的提交继续新的提交。同时，你继续使用协作者试图删除的提交。当他们推送时，他们将不得不"强制推送"，这应该向他们表明他们正在更改历史。**你认为当你尝试推送时会发生什么？**

在极端情况下，Git 可能会决定历史太不同，项目不再相关。这不常见，但是一个大问题。

最常见的结果是你的 `git push` 会将"已删除"的提交返回到共享历史中。（首先，如果你在同一分支上工作，你会 `git pull`，然后合并，但结果会是一样的。）这意味着无论删除什么重要的东西现在都回到了仓库中。密码、令牌或大型二进制文件可能会返回，而不会提醒你。

#### `git revert`

`git revert` 是用 Git 更改历史的最安全方式。`git revert` 不是删除现有提交，而是查看特定提交中引入的更改，然后在新的提交中应用这些更改的反向。它作为一个"撤销提交"命令，而不会牺牲仓库历史的完整性。**当可能时，`git revert` 始终是更改历史的推荐方式**。

#### `git reset`

有时，提交包含确实需要删除的敏感信息。`git reset` 是一个非常强大的命令，可能会导致你丢失工作。通过重置，你将 `HEAD` 指针和分支指针移动到另一个时间点 - 可能使中间的提交看起来从未发生过！在使用 `git reset` 之前：

- 确保与你的团队讨论任何共享提交
- 研究三种类型的重置，看看哪种适合你（--soft、--mixed、--hard）
- 提交任何你不想故意丢失的工作 - 已提交的工作可以找回，但未提交的工作不能

#### `git reflog`

如果你正在更改历史和撤销提交，你应该了解 `git reflog`。如果你遇到麻烦，reflog 可能会帮你摆脱困境。reflog 是 `HEAD` 指向的每个提交的日志。因此，例如，如果你使用 `git reset` 并意外丢失提交，你可以使用 `git reflog` 找到并访问它们。

### 使用 Git Commit Amend 更新提交

虽然 `git commit --amend` 确实会更改历史，但它只更改当前分支上最近的提交。这对于以下提交来说是一个非常有用的命令：

- 尚未推送到远程的提交
- 提交消息中有拼写错误
- 不包含你想要包含的更改

## Git Commit 的示例

一旦你暂存了想要包含在提交中的文件，你就准备好了。无论你是在 GitHub Desktop 等工具中提交，还是通过命令行提交，提交消息都很重要。提交消息应该简短且描述你的更改。如果你正在浏览仓库的历史，你将受到提交消息的指导，所以它们应该讲述一个故事。命令行中的提交可以包含以下格式的消息：

- `git commit -m "git commit 消息示例"`

提交消息应该是现在时和指令性的，如下面的示例：

- `git commit -m "为 Git 指南创建文件结构"`
- `git commit -m "将 Git 备忘单翻译成德语"`
- `git commit -m "更新 Git 资源的损坏 URL"`

如果你想在提交消息中包含更多上下文，你也可以包含扩展的提交消息。

## 相关命令

- `git add [文件]`：为版本控制准备文件快照，将其添加到暂存区。
- `git status`：总是个好主意，这个命令显示你在哪个分支上，工作区或暂存区中有哪些文件，以及其他重要信息。
- `git push`：将所有本地分支提交上传到远程。
- `git log`：浏览和检查项目文件的演变。 